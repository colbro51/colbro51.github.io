<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Camp Installer</title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="theme-color" content="#1976d2">

  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="apple-icon-180.png">
  <style>
/* INSTALLER CSS — TEMPORARY INLINE VERSION FOR DEVELOPMENT */

/* ============================================================
   INSTALLER SCREENS — clean, mobile‑first, full‑width layout
   ============================================================ */

.installer-screen {
    min-height: 100vh;
    padding: 32px 24px;
    box-sizing: border-box;

    display: flex;
    flex-direction: column;
    justify-content: center;

    /* Full-width content, no centering squeeze */
    align-items: stretch;
    text-align: left;

    background: #fafafa;
}

/* Headings: large, friendly, readable */
.installer-screen h1 {
    font-size: 30px;
    font-weight: 700;
    margin-bottom: 24px;
    text-align: center;   /* headings centered, text left */
}

/* Paragraphs + list items: full width, large text */
.installer-screen p,
.installer-screen li {
    font-size: 22px;
    line-height: 1.55;
    margin-bottom: 18px;
    width: 100%;
}

/* Improve spacing between sections */
.installer-screen .section {
    margin-bottom: 28px;
}

/* Primary action button */
.installer-screen .btn,
.copy-link-btn {
    background: #ff9800;
    color: #000;
    font-weight: bold;
    font-size: 22px;

    padding: 18px 24px;
    border-radius: 14px;

    width: 100%;
    max-width: 360px;

    text-align: center;
    margin: 24px auto 0 auto;

    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
}

.copy-link-btn:active,
.installer-screen .btn:active {
    background: #e68900;
}

/* Screen visibility */
.screen {
    display: none;
}

.screen.active {
    display: flex;
}

/* Slightly larger text on small Android screens */
@media (max-width: 480px) {
    .installer-screen p,
    .installer-screen li {
        font-size: 23px;
    }
}

</style>

</head>

<body>

<script>
// ------------------------------------------------------------
// Service worker
// ------------------------------------------------------------
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("service-worker.js?v=2");
}

// ------------------------------------------------------------
// PLATFORM DETECTION
// ------------------------------------------------------------
function isIOS() {
  const ua = navigator.userAgent.toLowerCase();
  return ua.includes("iphone") ||
         ua.includes("ipad")  ||
         ua.includes("ipod")  ||
         (ua.includes("like mac os x") && ua.includes("mobile"));
}

function isAndroid() {
  const ua = navigator.userAgent;
  return ua.includes("Android") && !ua.includes("Windows");
}

function isWindows() {
  return navigator.userAgent.toLowerCase().includes("windows");
}

// ------------------------------------------------------------
// BROWSER DETECTION (only used when install=true)
// ------------------------------------------------------------
function isSafariIOS() {
  const ua = navigator.userAgent;
  if (!isIOS()) return false;

  return ua.includes("Safari") &&
         !ua.includes("CriOS") &&
         !ua.includes("FxiOS") &&
         !ua.includes("EdgiOS") &&
         !ua.includes("DuckDuckGo");
}

function isChrome() {
  const ua = navigator.userAgent;
  return ua.includes("Chrome") &&
         ua.includes("Safari") &&
         !ua.includes("Firefox") &&
         !ua.includes("Edg");
}

// ------------------------------------------------------------
// STANDALONE DETECTION
// ------------------------------------------------------------
function isStandalone() {
  if (window.matchMedia('(display-mode: standalone)').matches) return true;
  if ('standalone' in navigator && navigator.standalone === true) return true;
  return false;
}

// ------------------------------------------------------------
// SCREEN SWITCHER
// ------------------------------------------------------------
function showScreen(id) {
  document.querySelectorAll(".screen").forEach(s => s.classList.remove("active"));
  const el = document.getElementById(id);
  if (el) el.classList.add("active");
}

// ------------------------------------------------------------
// COPY INSTALL LINK
// ------------------------------------------------------------
async function copyInstallLink() {
  const url = new URL(window.location.href);
  url.searchParams.set("install", "true");
  const link = url.toString();

  try {
    await navigator.clipboard.writeText(link);
    alert("Link copied to clipboard.");
  } catch {
    const temp = document.createElement("input");
    temp.value = link;
    document.body.appendChild(temp);
    temp.select();
    document.execCommand("copy");
    temp.remove();
    alert("Link copied to clipboard.");
  }
}

// ------------------------------------------------------------
// MAIN FLOW
// ------------------------------------------------------------
window.addEventListener("DOMContentLoaded", () => {

  const url = new URL(window.location.href);
  const install = url.searchParams.get("install") === "true";

  // PLATFORM
  let platform = "other";
  if (isIOS()) platform = "ios";
  else if (isAndroid()) platform = "android";
  else if (isWindows()) platform = "windows";

  // BROWSER (only matters when install=true)
  let browser = "other";
  if (isSafariIOS()) browser = "safari";
  else if (isChrome()) browser = "chrome";

  const justInstalled = localStorage.getItem("justInstalled") === "true";

  if (justInstalled) {
    // Chrome has opened the standalone window but hasn't set display-mode yet.
    // Skip installer screens entirely.
    window.location.href = "app.html?platform=" + platform;
    return;
  }

  // --------------------------------------------------------
  // If already installed → go straight to app
  // --------------------------------------------------------
  if (isStandalone()) {
    window.location.href = "app.html?platform=" + platform;
    return;
  }

  // --------------------------------------------------------
  // ALWAYS clear prefs only when installing
  // --------------------------------------------------------
  localStorage.removeItem("useGoogleMaps");
  localStorage.removeItem("helpNudgeShown");

  // --------------------------------------------------------
  // If install=true AND browser is correct → show instructions
  // --------------------------------------------------------
  if (install) {
    if (platform === "ios" && browser === "safari") {
      localStorage.setItem("justInstalled", "true");
      showScreen("install_ios");
      return;
    }

    if (platform === "android" && browser === "chrome") {
      localStorage.setItem("justInstalled", "true");
      showScreen("install_android");
      return;
    }

    if (platform === "windows" && browser === "chrome") {
      localStorage.setItem("justInstalled", "true");
      showScreen("install_windows");
      return;
    }

    // install=true but wrong browser → fall through to copy-link screen
  }

  // --------------------------------------------------------
  // Default: show "copy link and paste into correct browser"
  // --------------------------------------------------------
  if (platform === "ios") {
    showScreen("launch_safari");
    return;
  }

  if (platform === "android") {
    showScreen("launch_chrome");
    return;
  }

  if (platform === "windows") {
    showScreen("launch_edge");
    return;
  }

  showScreen("not_supported");
});
</script>

<!-- =========================================================
     INSTALL INSTRUCTIONS
     ========================================================= -->

<div id="install_android" class="screen installer-screen">
  <h1>Install Camp (Android)</h1>
  <p>Tap the <strong>⋮ menu</strong> in Chrome.</p>
  <p>Select <strong>Install App</strong> or <strong>Add to Home Screen</strong>.</p>
</div>

<div id="install_ios" class="screen installer-screen">
  <h1>Install Camp (iPhone)</h1>
  <ol>
    <li>Tap the <strong>Share</strong> button.</li>
    <li>Select <strong>Add to Home Screen</strong>.</li>
    <li>Open Camp from the new icon.</li>
  </ol>
</div>

<div id="install_windows" class="screen installer-screen">
  <h1>Install Camp (Windows)</h1>
  <p>Click the install button in the address bar.</p>
  <p>It may appear as a computer‑screen icon with a down‑arrow.</p>
</div>

<!-- =========================================================
     COPY-LINK SCREENS
     ========================================================= -->

<div id="launch_safari" class="screen installer-screen">
  <h1>Open in Safari</h1>
  <p>To install Camp, open this link in Safari.</p>
  <div class="copy-link-btn" onclick="copyInstallLink()">
          Copy install link to clipboard
    </div>
</div>

<div id="launch_chrome" class="screen installer-screen">
  <h1>Open in Chrome</h1>
  <p>To install Camp, open this link in Chrome.</p>
  <div class="copy-link-btn" onclick="copyInstallLink()">
          Copy install link to clipboard
    </div>
</div>

<div id="launch_edge" class="screen installer-screen">
  <h1>Open in Chrome</h1>
  <p>To install Camp on Windows, open this link in Chrome.</p>
  <div class="copy-link-btn" onclick="copyInstallLink()">
          Copy install link to clipboard
    </div>
</div>

<div id="not_supported" class="screen installer-screen">
  <h1>Camp Installer</h1>
  <p>Your platform is not supported.</p>
  <div class="copy-link-btn" onclick="copyInstallLink()">
          Copy install link to clipboard
    </div>
</div>

</body>
</html>