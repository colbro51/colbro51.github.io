<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Loading…</title>

// ADD THIS: Make index.html a PWA entry point
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#1976d2">
<link rel="apple-touch-icon" href="apple-icon-180.png">

</head>
<body>

<script>
//  ADD THIS: Register the service worker at the root
if ("serviceWorker" in navigator) {
    navigator.serviceWorker.register("service-worker.js");
}

// --- PLATFORM DETECTION ---
function isIOS() {
    const ua = navigator.userAgent.toLowerCase();
    return ua.includes("iphone") ||
           ua.includes("ipad")  ||
           ua.includes("ipod")  ||
           (ua.includes("like mac os x") && ua.includes("mobile"));
}

function isAndroid() {
    return /android/.test(navigator.userAgent.toLowerCase());
}

function isWindows() {
    return navigator.userAgent.toLowerCase().includes("windows");
}

function isFirefox() {
    if (typeof InstallTrigger !== "undefined") return true;
    const ua = navigator.userAgent;
    return ua.includes("Firefox") && !ua.includes("FxiOS");
}

function isSafariIOS() {
    const ua = navigator.userAgent;
    if (!isIOS()) return false;

    const isSafariUA =
        ua.includes("Safari") &&
        !ua.includes("CriOS") &&
        !ua.includes("FxiOS") &&
        !ua.includes("EdgiOS") &&
        !ua.includes("DuckDuckGo");

    // drop the hasStandalone check – it’s too brittle
    return isSafariUA;
}

function isStandalone() {
    if (window.matchMedia('(display-mode: standalone)').matches) return true;
    if ('standalone' in navigator && navigator.standalone === true) return true;
    return false;
}

window.addEventListener("DOMContentLoaded", () => {
    const params = new URLSearchParams();

    // PLATFORM
    if (isIOS()) params.set("platform", "ios");
    else if (isAndroid()) params.set("platform", "android");
    else if (isWindows()) params.set("platform", "windows");
    else params.set("platform", "other");

    // BROWSER
    if (isFirefox()) params.set("browser", "firefox");
    else if (isSafariIOS()) params.set("browser", "safari");
    else params.set("browser", "other");

    // STANDALONE
    params.set("standalone", isStandalone() ? "true" : "false");

    window.location.href = "app.html?" + params.toString();
});
</script>

</body>
</html>